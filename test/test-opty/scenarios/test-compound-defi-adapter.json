{
  "title": "Test DeFi Adapter",
  "description": "Test cases for DeFi adapters.",
  "stories": [
    {
      "description": "getDepositAllCodes() with 100% protocol investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolPct(uint256)",
          "args": {
            "maxDepositProtocolPct": "10000"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": ">0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": "=0"
        }
      ],
      "cleanActions": [
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ]
    },
    {
      "description": "getWithdrawAllCodes() with 100% protocol investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolPct(uint256)",
          "args": {
            "maxDepositProtocolPct": "10000"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": "=0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": ">0"
        }
      ],
      "cleanActions": []
    },
    {
      "description": "getDepositAllCodes() with 0.1% protocol investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolPct(uint256)",
          "args": {
            "maxDepositProtocolPct": "10"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": ">0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": "=0"
        }
      ],
      "cleanActions": [
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ]
    },
    {
      "description": "getWithdrawAllCodes() with 0.1% protocol investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolPct(uint256)",
          "args": {
            "maxDepositProtocolPct": "10"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": "=0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": ">0"
        }
      ],
      "cleanActions": []
    },
    {
      "description": "getDepositAllCodes() with 100% pool investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositPoolPct(address,uint256)",
          "args": {
            "maxDepositPoolPct": "10000"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": ">0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": "=0"
        }
      ],
      "cleanActions": [
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ]
    },
    {
      "description": "getWithdrawAllCodes() with 100% pool investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositPoolPct(address,uint256)",
          "args": {
            "maxDepositPoolPct": "10000"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": "=0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": ">0"
        }
      ],
      "cleanActions": []
    },
    {
      "description": "getDepositAllCodes() with 0.9% pool investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositPoolPct(address,uint256)",
          "args": {
            "maxDepositPoolPct": "90"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": ">0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": "=0"
        }
      ],
      "cleanActions": [
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ]
    },
    {
      "description": "getWithdrawAllCodes() with 0.9% pool investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositPoolPct(address,uint256)",
          "args": {
            "maxDepositPoolPct": "90"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": "=0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": ">0"
        }
      ],
      "cleanActions": []
    },
    {
      "description": "getDepositAllCodes() with 0 investment limit (mode=number)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "0"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositAmount(address,address,uint256)",
          "args": {
            "maxDepositAmount": "0"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": "=0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": "=0"
        }
      ],
      "cleanActions": [
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ]
    },
    {
      "description": "getDepositAllCodes() with investment limit = 20 (less than the deposit amount) (mode=number)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "0"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositAmount(address,address,uint256)",
          "args": {
            "maxDepositAmount": "20"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": ">0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": ">0"
        }
      ],
      "cleanActions": [
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ]
    },
    {
      "description": "getWithdrawAllCodes() with investment limit = 20 (less than the deposit amount) (mode=number)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "0"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositAmount(address,address,uint256)",
          "args": {
            "maxDepositAmount": "20"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": "=0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": ">0"
        }
      ],
      "cleanActions": []
    },
    {
      "description": "getDepositAllCodes() with investment limit = 300000 (more than the deposit amount) (mode=number)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "0"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositAmount(address,address,uint256)",
          "args": {
            "maxDepositAmount": "300000"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": ">0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": "=0"
        }
      ],
      "cleanActions": [
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ]
    },
    {
      "description": "getWithdrawAllCodes() with investment limit = 300000 (more than the deposit amount) (mode=number)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolMode(uint8)",
          "args": {
            "mode": "0"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositAmount(address,address,uint256)",
          "args": {
            "maxDepositAmount": "300000"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetDepositAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "testGetWithdrawAllCodes(address,address,address)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": "=0"
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": ">0"
        }
      ],
      "cleanActions": []
    }
  ],
  "_pendingStories": [
    {
      "description": "getDepositSomeCodes() with 100% protocol investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositPoolType(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolPct(uint256)",
          "args": {
            "maxDepositProtocolPct": "10000"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "depositSome(address,address,address,uint256)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": {}
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner"
        }
      ]
    },
    {
      "description": "getDepositSomeCodes() with pool investment limit (mode=pct)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositPoolType(uint8)",
          "args": {
            "mode": "1"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolPct(uint256)",
          "args": {
            "maxDepositProtocolPct": "1"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositProtocolPct(uint256)",
          "args": {
            "maxDepositProtocolPct": "10000"
          },
          "executer": "owner"
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "depositSome(address,address,address,uint256)",

          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": {}
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": {}
        }
      ]
    },
    {
      "description": "getDepositSomeCodes() with 0 investment limit (mode=number)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositPoolType(uint8)",
          "args": {
            "mode": "0"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositAmount(address,uint256)",
          "args": {
            "maxDepositAmount": "0"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "depositSome(address,address,address,uint256)",
          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": {}
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": {}
        }
      ]
    },
    {
      "description": "getDepositSomeCodes() with investment limit (mode=number)",
      "setActions": [
        {
          "contract": "adapter",
          "action": "setMaxDepositPoolType(uint8)",
          "args": {
            "mode": "0"
          },
          "executer": "owner"
        },
        {
          "contract": "adapter",
          "action": "setMaxDepositAmount(address,uint256)",
          "args": {
            "maxDepositAmount": "10"
          },
          "expect": "success",
          "message": ""
        },
        {
          "contract": "",
          "action": "fundTestDeFiAdapterContract",

          "expect": "success",
          "message": ""
        },
        {
          "contract": "TestDeFiAdapter",
          "action": "depositSome(address,address,address,uint256)",

          "executer": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "adapter",
          "action": "getLiquidityPoolTokenBalance(address,address,address)",
          "executer": "owner",
          "expectedValue": {}
        },
        {
          "contract": "erc20",
          "action": "balanceOf(address)",
          "executer": "owner",
          "expectedValue": {}
        }
      ]
    }
  ]
}
