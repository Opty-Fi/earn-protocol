{
  "title": "Discontinue and Pause: Positive (pass) and Negative (reverts)",
  "description": "Test cases for the setDiscontinue() and unpauseVault() functions",
  "vaults": [
    {
      "name": "Vault",
      "profile": "RP1",
      "stories": [
        {
          "description": "[Vault is paused By Default] Should fail when user deposits in the vault contract",
          "actions": [
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "fail",
              "message": "paused"
            }
          ]
        },
        {
          "description": "[Vault is paused By Default] Should fail when user deposits all balance in the vault contract",
          "actions": [
            {
              "contract": "Vault",
              "action": "userDepositAllRebalance()",
              "args": {
                "amount": ""
              },
              "expect": "fail",
              "message": "paused"
            }
          ]
        },
        {
          "description": "[Vault is paused By Default] Should fail when user withdraws from the vault contract",
          "actions": [
            {
              "contract": "Vault",
              "action": "userWithdrawRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "fail",
              "message": "paused"
            }
          ]
        },
        {
          "description": "[Vault is paused By Default] Should fail when user withdraws all balance from the vault contract",
          "actions": [
            {
              "contract": "Vault",
              "action": "userWithdrawAllRebalance()",
              "args": {
                "amount": ""
              },
              "expect": "fail",
              "message": "paused"
            }
          ]
        },
        {
          "description": "[Vault is unpaused] Should pass when user deposits and withdraws from the vault contract",
          "actions": [
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": true
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userWithdrawAllRebalance()",
              "args": {
                "amount": ""
              },
              "expect": "success",
              "message": ""
            }
          ]
        },
        {
          "description": "[Vault is reset to pause] Should throw an error when vault is paused and user deposits in the vault contract",
          "actions": [
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": false
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "fail",
              "message": "paused"
            }
          ]
        },
        {
          "description": "User should be able to deposit when vault is unpaused and shouldn't able to withdraw if vault is paused",
          "actions": [
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": true
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": false
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userWithdrawRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "fail",
              "message": "paused"
            }
          ]
        },
        {
          "description": "User should be able to deposit when vault is unpaused and shouldn't able to withdraw all balance if vault is paused",
          "actions": [
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": true
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": false
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userWithdrawAllRebalance()",
              "args": {
                "amount": ""
              },
              "expect": "fail",
              "message": "paused"
            }
          ]
        },
        {
          "description": "Vault unpaused, 1 userDepositRebalance, then vault shouldn't hold tokens and then vault paused and vault should hold tokens",
          "actions": [
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": true
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "balance()",
              "args": {
                "expectedValue": "0"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": false
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "balance()",
              "args": {
                "expectedValue": ">=2000000000000000000"
              },
              "expect": "success",
              "message": ""
            }
          ]
        },
        {
          "description": "Vault unpaused, 2 userDepositRebalance, then vault shouldn't hold tokens and then vault paused and vault should hold tokens",
          "actions": [
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": true
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "balance()",
              "args": {
                "expectedValue": "0"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": false
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "balance()",
              "args": {
                "expectedValue": ">=4000000000000000000"
              },
              "expect": "success",
              "message": ""
            }
          ]
        },
        {
          "description": "Step1: Vault unpaused, Step2: 1 userDepositRebalance, then Step3: vault shouldn't hold tokens and then Step4: vault paused and Step5: vault should hold tokens. Now Repeat Step1,2,3",
          "actions": [
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": true
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "balance()",
              "args": {
                "expectedValue": "0"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": false
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "balance()",
              "args": {
                "expectedValue": ">=2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": true
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "balance()",
              "args": {
                "expectedValue": "0"
              },
              "expect": "success",
              "message": ""
            }
          ]
        },
        {
          "description": "[Vault is discontinued] Vault Should hold tokens after vault is discontinued",
          "actions": [
            {
              "contract": "Registry",
              "action": "unpauseTokenizationContract(address,bool)",
              "args": {
                "unpause": true
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "balance()",
              "args": {
                "expectedValue": "0"
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Registry",
              "action": "discontinue(address)",
              "args": {
                "unpause": ""
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "balance()",
              "args": {
                "expectedValue": ">=2000000000000000000"
              },
              "expect": "success",
              "message": ""
            }
          ]
        },
        {
          "description": "[Vault is discontinued] User should be able to withdraw from the vault contract even if the vault is discontinued",
          "actions": [
            {
              "contract": "Registry",
              "action": "discontinue(address)",
              "args": {
                "unpause": ""
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userWithdrawAllRebalance()",
              "args": {
                "amount": ""
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "erc20",
              "action": "balanceOf(address)",
              "args": {
                "expectedValue": ">0"
              },
              "expect": "success",
              "message": ""
            }
          ]
        },
        {
          "description": "[Vault is discontinued] Should throw an error when vault is discontinued and user deposits in the vault contract",
          "actions": [
            {
              "contract": "Registry",
              "action": "discontinue(address)",
              "args": {
                "unpause": ""
              },
              "expect": "success",
              "message": ""
            },
            {
              "contract": "Vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": "2000000000000000000"
              },
              "expect": "fail",
              "message": "discontinued"
            }
          ]
        }
      ]
    }
  ]
}
