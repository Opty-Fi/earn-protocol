{
  "title": "APROracle",
  "description": "Test cases for APROracle integration in RiskManager and StrategyProvider",
  "stories": [
    {
      "description": "getBestStrategy should return 0x00 strategy by default if the token is not supported by Aave or Compound and the default strategy state is CompoundOrAave",
      "setActions": [
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x973e52691176d36453868D9d86572788d27041A9"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x973e52691176d36453868D9d86572788d27041A9"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x973e52691176d36453868D9d86572788d27041A9"]
          },
          "expectedValue": "0x0000000000000000000000000000000000000000000000000000000000000000"
        }
      ]
    },
    {
      "description": "getBestStrategy should return 0x00 strategy by default if the default strategy state is CompoundOrAave but Compound and Aave's strategies are not set",
      "setActions": [
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "expectedValue": "0x0000000000000000000000000000000000000000000000000000000000000000"
        }
      ]
    },
    {
      "description": "getBestStrategy should return by default the strategy with the highest APR if Compound and Aave's strategies are set and the default strategy state is CompoundOrAave",
      "setActions": [
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "outputToken": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x028171bCA77440897B824Ca71D1c56caC55b68A3"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "outputToken": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expectedValue": "0x2374c396f9c9606b60a1fd0da12749951230fb89a0228b47dd1bccaaaaa6251b"
        }
      ]
    },
    {
      "description": "getBestStrategy should return the default strategy (Aave or Compound) if strategy is not qualified (liquidityPool is not approved) and the default strategy state is CompoundOrAave",
      "setActions": [
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "outputToken": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x028171bCA77440897B824Ca71D1c56caC55b68A3"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "outputToken": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "strategyProvider",
          "action": "setBestStrategy(string,bytes32,bytes32)",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f",
            "riskProfile": "RP1"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "expectedValue": "0x2374c396f9c9606b60a1fd0da12749951230fb89a0228b47dd1bccaaaaa6251b"
        }
      ]
    },
    {
      "description": "getBestStrategy should return the default strategy (Aave or Compound) if strategy is not qualified (rate is not in expected range) and the default strategy state is CompoundOrAave",
      "setActions": [
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [2, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "outputToken": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x028171bCA77440897B824Ca71D1c56caC55b68A3"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "outputToken": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "rateLiquidityPool(address,uint8)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
            "score": 0
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "strategyProvider",
          "action": "setBestStrategy(string,bytes32,bytes32)",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f",
            "riskProfile": "RP1"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "expectedValue": "0x2374c396f9c9606b60a1fd0da12749951230fb89a0228b47dd1bccaaaaa6251b"
        }
      ]
    },
    {
      "description": "getBestStrategy should return the best strategy and not the default one if strategy is qualified and even if the default strategy state is CompoundOrAave",
      "setActions": [
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "outputToken": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x028171bCA77440897B824Ca71D1c56caC55b68A3"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "outputToken": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "rateLiquidityPool(address,uint8)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
            "score": 1
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "strategyProvider",
          "action": "setBestStrategy(string,bytes32,bytes32)",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f",
            "riskProfile": "RP1"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "expectedValue": "0x2c365ec0925c4400f3c0ad18ddcdd76c24a997ec8f0c2b4d35b6092783b6ac6a"
        }
      ]
    },
    {
      "description": "getBestStrategy should return the best strategy and not the default one if strategy is qualified and even if the default strategy state is Zero",
      "setActions": [
        {
          "contract": "strategyProvider",
          "action": "setDefaultStrategyState(uint8)",
          "args": {
            "defaultStrategyState": 0
          },
          "executor": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "outputToken": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x028171bCA77440897B824Ca71D1c56caC55b68A3"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "outputToken": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "rateLiquidityPool(address,uint8)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
            "score": 1
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "strategyProvider",
          "action": "setBestStrategy(string,bytes32,bytes32)",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f",
            "riskProfile": "RP1"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "expectedValue": "0x2c365ec0925c4400f3c0ad18ddcdd76c24a997ec8f0c2b4d35b6092783b6ac6a"
        }
      ]
    },
    {
      "description": "getBestStrategy should return the best default strategy and not the Compound or Aave one if the default strategy state is Zero",
      "setActions": [
        {
          "contract": "strategyProvider",
          "action": "setDefaultStrategyState(uint8)",
          "args": {
            "defaultStrategyState": 0
          },
          "executor": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "outputToken": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x028171bCA77440897B824Ca71D1c56caC55b68A3"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "outputToken": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "rateLiquidityPool(address,uint8)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
            "score": 1
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "strategyProvider",
          "action": "setBestDefaultStrategy(string,bytes32,bytes32)",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f",
            "riskProfile": "RP1"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "expectedValue": "0x2c365ec0925c4400f3c0ad18ddcdd76c24a997ec8f0c2b4d35b6092783b6ac6a"
        }
      ]
    },
    {
      "description": "getBestStrategy should return the best default strategy and not the Compound or Aave one if the default strategy state is CompoundOrAave",
      "setActions": [
        {
          "contract": "strategyProvider",
          "action": "setDefaultStrategyState(uint8)",
          "args": {
            "defaultStrategyState": 1
          },
          "executor": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "outputToken": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x028171bCA77440897B824Ca71D1c56caC55b68A3"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "outputToken": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "rateLiquidityPool(address,uint8)",
          "args": {
            "token": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
            "score": 1
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "strategyProvider",
          "action": "setBestDefaultStrategy(string,bytes32,bytes32)",
          "args": {
            "strategy": [
              {
                "contract": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "outputToken": "0xab7FA2B2985BCcfC13c6D86b1D5A17486ab1e04C",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f",
            "riskProfile": "RP1"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "expectedValue": "0x2c365ec0925c4400f3c0ad18ddcdd76c24a997ec8f0c2b4d35b6092783b6ac6a"
        }
      ]
    },
    {
      "description": "getBestStrategy should return the best default strategy (even if it is Compound) and not the one returned by the APR oracle (although it can be the same)",
      "setActions": [
        {
          "contract": "strategyProvider",
          "action": "setDefaultStrategyState(uint8)",
          "args": {
            "defaultStrategyState": 0
          },
          "executor": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "outputToken": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x028171bCA77440897B824Ca71D1c56caC55b68A3"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "outputToken": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "strategyProvider",
          "action": "setBestDefaultStrategy(string,bytes32,bytes32)",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f",
            "riskProfile": "RP1"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "expectedValue": "0xf14294bb238069facb3da995a8d6e805967558c99956a61ce7aa8b53954db845"
        }
      ]
    },
    {
      "description": "User that is not strategyOperator shouldn't be able to set the default strategy state",
      "setActions": [
        {
          "contract": "strategyProvider",
          "action": "setDefaultStrategyState(uint8)",
          "args": {
            "defaultStrategyState": 0
          },
          "executor": "user1",
          "expect": "fail",
          "message": "caller is not the strategyOperator"
        }
      ],
      "getActions": []
    },
    {
      "description": "User that is strategyOperator should be able to set the default strategy state",
      "setActions": [
        {
          "contract": "strategyProvider",
          "action": "setDefaultStrategyState(uint8)",
          "args": {
            "defaultStrategyState": 0
          },
          "executor": "owner",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": []
    },
    {
      "description": "getBestStrategy should return by default 0x00 strategy if Compound and Aave's strategies are set but the default strategy state is Zero",
      "setActions": [
        {
          "contract": "strategyProvider",
          "action": "setDefaultStrategyState(uint8)",
          "args": {
            "defaultStrategyState": 0
          },
          "executor": "owner",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "addRiskProfile(string,bool,(uint8,uint8))",
          "args": {
            "riskProfile": "RP1",
            "canBorrow": false,
            "poolRatingRange": [0, 10]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveToken(address)",
          "args": {
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "setTokensHashToTokens(address[])",
          "args": {
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "outputToken": "0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "outputToken": "0xfC1E690f61EFd961294b3e1Ce3313fBD8aa4f85d",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "registry",
          "action": "approveLiquidityPool(address)",
          "args": {
            "token": "0x028171bCA77440897B824Ca71D1c56caC55b68A3"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        },
        {
          "contract": "vaultStepInvestStrategyDefinitionRegistry",
          "action": "setStrategy(bytes32,(address,address,bool)[])",
          "args": {
            "strategy": [
              {
                "contract": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "outputToken": "0x028171bCA77440897B824Ca71D1c56caC55b68A3",
                "isBorrow": false
              }
            ],
            "token": "0x6b175474e89094c44da98b954eedeac495271d0f"
          },
          "executor": "",
          "expect": "success",
          "message": ""
        }
      ],
      "getActions": [
        {
          "contract": "riskManager",
          "action": "getBestStrategy(string,address[])",
          "args": {
            "riskProfile": "RP1",
            "tokens": ["0x6b175474e89094c44da98b954eedeac495271d0f"]
          },
          "executor": "",
          "expectedValue": "0x0000000000000000000000000000000000000000000000000000000000000000"
        }
      ]
    }
  ]
}
